on: push
name: ğŸš€ Deploy website on push
jobs:
    build:
        name: â› Build
        runs-on: ubuntu-latest
        steps:
            - name: ğŸšš Get latest code
              uses: actions/checkout@main

            - name: âœ… Install Node
              uses: actions/setup-node@v3
              with:
                  node-version: "18"

            - name: ğŸ‰ Install Yarn
              run: npm install -g yarn

            - name: ğŸ“¦ Installing Packages
              run: yarn install

            - name: ğŸ—ï¸ Buidling Project
              env:
                  PUBLIC_SANITY_PROJECT_ID: ${{ secrets.PUBLIC_SANITY_PROJECT_ID }}
                  PUBLIC_SANITY_DATASET: ${{ secrets.PUBLIC_SANITY_DATASET }}
                  PUBLIC_SANITY_GRAPHQL_URL: ${{ secrets.PUBLIC_SANITY_GRAPHQL_URL }}
              run: yarn build
              working-directory: ./web

            - name: ğŸ“¥ Archive production artifact
              uses: actions/upload-artifact@main
              with:
                  name: dist
                  path: web/dist/

    deploy:
        name: ğŸ‰ Deploy
        needs: build
        runs-on: ubuntu-latest
        steps:
            # - name: ğŸšš Get latest code
            #   uses: actions/checkout@main

            - name: â¬‡ï¸ Download artifact
              uses: actions/download-artifact@main
              with:
                  name: dist

            - name: ğŸ§ª Test Artifact
              run: ls -R

            - name: ğŸŒ Global Config
              run: git config --global user.email "you@example.com" && git config --global user.name "Your Name"

            - name: ğŸ›ï¸ Gitify
              run: git init

            - name: ğŸ•¸ï¸ Commit
              run: git add . && git commit -m "Init"

            - name: ğŸ“‚ Sync files
              uses: SamKirkland/FTP-Deploy-Action@3.1.1
              with:
                  ftp-server: ${{ secrets.FTP_SERVER }}
                  ftp-username: ${{ secrets.FTP_USERNAME }}
                  ftp-password: ${{ secrets.FTP_PASSWORD }}
                  git-ftp-args: --insecure
